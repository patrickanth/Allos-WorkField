<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Allos WorkField - Nuova Nota</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: transparent;
      overflow: hidden;
    }

    .container {
      width: 360px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    /* Header */
    .header {
      padding: 16px 20px;
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      display: flex;
      align-items: center;
      justify-content: space-between;
      -webkit-app-region: drag;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo svg {
      width: 18px;
      height: 18px;
      fill: white;
    }

    .header-title {
      color: white;
      font-weight: 600;
      font-size: 14px;
    }

    .close-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: none;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-app-region: no-drag;
      transition: background 0.2s;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Content */
    .content {
      padding: 20px;
    }

    /* Time display */
    .time-display {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
      color: #64748b;
      font-size: 13px;
    }

    .time-display svg {
      width: 16px;
      height: 16px;
    }

    /* Textarea */
    .note-input {
      width: 100%;
      min-height: 150px;
      padding: 14px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-family: inherit;
      font-size: 14px;
      resize: none;
      outline: none;
      transition: border-color 0.2s;
    }

    .note-input:focus {
      border-color: #0ea5e9;
    }

    .note-input::placeholder {
      color: #94a3b8;
    }

    /* Privacy toggle */
    .privacy-section {
      margin-top: 16px;
      display: flex;
      gap: 12px;
    }

    .privacy-option {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .privacy-option:hover {
      border-color: #cbd5e1;
    }

    .privacy-option.active {
      border-color: #0ea5e9;
      background: #f0f9ff;
    }

    .privacy-option input {
      display: none;
    }

    .privacy-icon {
      width: 20px;
      height: 20px;
      color: #64748b;
    }

    .privacy-option.active .privacy-icon {
      color: #0ea5e9;
    }

    .privacy-label {
      font-size: 13px;
      font-weight: 500;
      color: #334155;
    }

    /* Submit button */
    .submit-btn {
      width: 100%;
      margin-top: 16px;
      padding: 14px;
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .submit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
    }

    .submit-btn:active {
      transform: translateY(0);
    }

    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Status message */
    .status {
      margin-top: 12px;
      padding: 10px;
      border-radius: 8px;
      font-size: 13px;
      text-align: center;
      display: none;
    }

    .status.success {
      display: block;
      background: #dcfce7;
      color: #166534;
    }

    .status.error {
      display: block;
      background: #fee2e2;
      color: #991b1b;
    }

    /* Login view */
    .login-view {
      display: none;
    }

    .login-view.active {
      display: block;
    }

    .note-view.hidden {
      display: none;
    }

    .login-title {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .login-subtitle {
      font-size: 13px;
      color: #64748b;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 14px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: #475569;
      margin-bottom: 6px;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-family: inherit;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }

    .form-input:focus {
      border-color: #0ea5e9;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left">
        <div class="logo">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>
        </div>
        <span class="header-title">Allos WorkField</span>
      </div>
      <button class="close-btn" id="closeBtn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <div class="content">
      <!-- Login View -->
      <div class="login-view" id="loginView">
        <h2 class="login-title">Accedi</h2>
        <p class="login-subtitle">Inserisci le tue credenziali per continuare</p>

        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="loginEmail" placeholder="nome@azienda.com">
        </div>

        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="loginPassword" placeholder="••••••••">
        </div>

        <button class="submit-btn" id="loginBtn">Accedi</button>
        <div class="status" id="loginStatus"></div>
      </div>

      <!-- Note View -->
      <div class="note-view" id="noteView">
        <div class="time-display">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span id="currentTime"></span>
        </div>

        <textarea
          class="note-input"
          id="noteContent"
          placeholder="Scrivi qui la tua nota..."
          autofocus
        ></textarea>

        <div class="privacy-section">
          <label class="privacy-option active" id="privateOption">
            <input type="radio" name="privacy" value="private" checked>
            <svg class="privacy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0110 0v4"/>
            </svg>
            <span class="privacy-label">Privata</span>
          </label>
          <label class="privacy-option" id="sharedOption">
            <input type="radio" name="privacy" value="shared">
            <svg class="privacy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
            </svg>
            <span class="privacy-label">Condivisa</span>
          </label>
        </div>

        <button class="submit-btn" id="submitBtn">Salva Nota</button>
        <div class="status" id="status"></div>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    // Elements
    const closeBtn = document.getElementById('closeBtn');
    const noteContent = document.getElementById('noteContent');
    const submitBtn = document.getElementById('submitBtn');
    const status = document.getElementById('status');
    const currentTime = document.getElementById('currentTime');
    const privateOption = document.getElementById('privateOption');
    const sharedOption = document.getElementById('sharedOption');
    const loginView = document.getElementById('loginView');
    const noteView = document.getElementById('noteView');
    const loginBtn = document.getElementById('loginBtn');
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const loginStatus = document.getElementById('loginStatus');

    let isPrivate = true;

    // Update time
    function updateTime() {
      const now = new Date();
      const options = {
        hour: '2-digit',
        minute: '2-digit',
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      };
      currentTime.textContent = now.toLocaleDateString('it-IT', options);
    }
    updateTime();
    setInterval(updateTime, 1000);

    // Close button
    closeBtn.addEventListener('click', () => {
      ipcRenderer.send('close-popup');
    });

    // Privacy toggle
    privateOption.addEventListener('click', () => {
      isPrivate = true;
      privateOption.classList.add('active');
      sharedOption.classList.remove('active');
    });

    sharedOption.addEventListener('click', () => {
      isPrivate = false;
      sharedOption.classList.add('active');
      privateOption.classList.remove('active');
    });

    // Submit note
    submitBtn.addEventListener('click', () => {
      const content = noteContent.value.trim();
      if (!content) return;

      submitBtn.disabled = true;
      submitBtn.textContent = 'Salvando...';

      ipcRenderer.send('save-note', {
        content,
        isPrivate
      });
    });

    // Login
    loginBtn.addEventListener('click', () => {
      const email = loginEmail.value.trim();
      const password = loginPassword.value;

      if (!email || !password) return;

      loginBtn.disabled = true;
      loginBtn.textContent = 'Accesso...';

      ipcRenderer.send('login', { email, password });
    });

    // Handle note saved
    ipcRenderer.on('note-saved', (event, result) => {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Salva Nota';

      if (result.error) {
        status.className = 'status error';
        status.textContent = result.error;
      } else {
        status.className = 'status success';
        status.textContent = 'Nota salvata con successo!';
        noteContent.value = '';

        setTimeout(() => {
          status.className = 'status';
          ipcRenderer.send('close-popup');
        }, 1500);
      }
    });

    // Handle login result
    ipcRenderer.on('login-result', (event, result) => {
      loginBtn.disabled = false;
      loginBtn.textContent = 'Accedi';

      if (result.success) {
        loginView.classList.remove('active');
        noteView.classList.remove('hidden');
      } else {
        loginStatus.className = 'status error';
        loginStatus.textContent = result.error || 'Errore durante l\'accesso';
      }
    });

    // Check if logged in
    ipcRenderer.send('get-settings');
    ipcRenderer.on('settings', (event, settings) => {
      if (settings.isLoggedIn) {
        loginView.classList.remove('active');
        noteView.classList.remove('hidden');
      } else {
        loginView.classList.add('active');
        noteView.classList.add('hidden');
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        ipcRenderer.send('close-popup');
      }
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        submitBtn.click();
      }
    });
  </script>
</body>
</html>
